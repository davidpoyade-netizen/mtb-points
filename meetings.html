<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Evenenements – MTB Points</title>
  <style>
    :root{
      --bg:#f4f4f4;--card:#ffffff;--text:#0f172a;--muted:#64748b;--border:#e5e7eb;--blue:#2563eb;
      --ok:#22c55e;--warn:#ef4444;--dark:#111827;
    }
    body{margin:0;background:var(--bg);color:var(--text);font-family:Arial,Helvetica,sans-serif;}
    header{background:var(--card);padding:14px 16px;box-shadow:0 2px 10px rgba(0,0,0,.06);}
    header h1{margin:0;font-size:22px}
    .wrap{max-width:980px;margin:22px auto;padding:0 16px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px 18px;margin:14px 0;box-shadow:0 2px 10px rgba(0,0,0,.05);}
    .toc a{display:block;text-decoration:none;color:var(--blue);padding:6px 0}
    h2{margin:0 0 10px 0;font-size:18px}
    h3{margin:14px 0 6px 0;font-size:15px}
    p,li{font-size:14px;line-height:1.6}
    ul{padding-left:18px;margin:8px 0}
    code{background:#f1f5f9;border:1px solid var(--border);border-radius:8px;padding:2px 6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:13px}
    .muted{color:var(--muted);font-size:13px}
    .box{background:#f8fafc;border:1px solid var(--border);border-left:5px solid var(--blue);border-radius:12px;padding:12px;margin:12px 0}
    .pill{display:inline-block;background:#f1f5f9;border:1px solid var(--border);border-radius:999px;padding:5px 10px;font-size:12px;font-weight:800}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:800px){.grid2{grid-template-columns:1fr}}
    footer{padding:26px 16px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
<header>
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MTB Points - Evenements</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .wrap { max-width: 980px; margin: 40px auto; padding: 0 16px; }
    .card { background:#fff; border-radius:12px; padding:22px; box-shadow:0 2px 10px rgba(0,0,0,.08); }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .btn2 { display:inline-block; padding:12px 16px; border-radius:10px; text-decoration:none; border:1px solid #cbd5e1; }
    .primary { background:#2563eb; color:#fff; border:0; }
    .muted { color:#667085; }
    @media (max-width: 800px){ .grid{ grid-template-columns:1fr; } }
  </style>
</head>
<body>

<header class="header">
  <h1>MTB Points- Evenements</h1>
  <nav>
<a href="public-ranking.html">Classement</a>
    <a href="meetings.html">Événements</a>
    <a href="reglement.html">Règlement</a>
    <a href="methodologie.html" class="active">Méthodologie (calcul)</a>
    <a href="about.html">À propos</a>
    <a href="login.html">Connexion</a>
  </nav>
  <div class="lang">
    <button class="btn" id="btnFR">FR</button>
    <button class="btn" id="btnEN">EN</button>
  </div>
</header>
</header>

<div class="wrap">
  <div class="card">
    <label style="font-weight:700;display:block;margin-bottom:6px;">Recherche</label>
    <input id="q" type="text" placeholder="Nom, lieu, commentaire..." />
    <div class="muted" style="margin-top:10px;">
      Résultats : <strong id="count">0</strong>
    </div>
  </div>
<div style="margin:14px 0;">
  <a href="meeting-create.html"
     style="display:inline-block;padding:12px 16px;
            background:#16a34a;color:#fff;
            border-radius:10px;
            text-decoration:none;
            font-weight:700;">
    + Créer un événement
  </a>
</div>

  <div id="meetingsList" class="list"></div>
</div>

<script src="js/storage.js"></script>
<script>
(function(){
  const list = document.getElementById("meetingsList");
  const qEl = document.getElementById("q");
  const countEl = document.getElementById("count");

  function normalize(s){
    return String(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();
  }
  function valOrDash(x){ const s = String(x||"").trim(); return s ? s : "—"; }

  // loadMeetings() vient de storage.js (ajouté précédemment)
  const meetings = (typeof loadMeetings === "function") ? loadMeetings() : [];

  function render(items){
    countEl.textContent = String(items.length);

    if (!items.length) {
      list.innerHTML = `<div class="muted">Aucun événement enregistré.</div>`;
      return;
    }

    list.innerHTML = items.map(m => {
      const nRaces = (m.raceIds && m.raceIds.length) ? m.raceIds.length : 0;
      return `
        <a class="item" href="meeting.html?id=${encodeURIComponent(m.id)}">
          <div class="title">
            ${valOrDash(m.name)}
            <span class="badge">${nRaces} épreuve${nRaces>1?"s":""}</span>
          </div>
          <div class="muted" style="margin-top:6px;">
            ${valOrDash(m.date)} • ${valOrDash(m.location)}
          </div>
          ${m.comment ? `<div class="muted" style="margin-top:6px;">${m.comment}</div>` : ``}
        </a>
      `;
    }).join("");
  }

  function apply(){
    const q = normalize(qEl.value);
    let items = meetings.slice();

    if (q) {
      items = items.filter(m => {
        const hay = normalize([m.name, m.location, m.comment].join(" "));
        return hay.includes(q);
      });
    }

    // tri : plus récent d'abord si date au format YYYY-MM-DD
    items.sort((a,b) => String(b.date||"").localeCompare(String(a.date||"")));

    render(items);
  }

  qEl.addEventListener("input", apply);
  apply();
})();
</script>

</body>
</html>
