<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Événements</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;margin:0}
    header{background:#fff;padding:14px 16px;box-shadow:0 1px 8px rgba(0,0,0,.06);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
    nav a{margin-right:10px;text-decoration:none;color:#2563eb}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .muted{color:#667085}
    .list{display:grid;gap:12px;margin-top:12px}
    .item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.05);text-decoration:none;color:inherit}
    .title{font-weight:800;font-size:18px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#f1f5f9;margin-left:8px}
    input{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:10px}
  </style>
</head>
<body>

<header>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="events.html">Épreuves</a>
    <a href="meetings.html">Événements</a>
    <a href="events.html">Épreuves</a>
  </nav>
  <div class="muted">Regroupe plusieurs épreuves (20/30/40/50 km…)</div>
</header>

<div class="wrap">
  <div class="card">
    <label style="font-weight:700;display:block;margin-bottom:6px;">Recherche</label>
    <input id="q" type="text" placeholder="Nom, lieu, commentaire..." />
    <div class="muted" style="margin-top:10px;">
      Résultats : <strong id="count">0</strong>
    </div>
  </div>
<div style="margin:14px 0;">
  <a href="meeting-create.html"
     style="display:inline-block;padding:12px 16px;
            background:#16a34a;color:#fff;
            border-radius:10px;
            text-decoration:none;
            font-weight:700;">
    + Créer un événement
  </a>
</div>

  <div id="meetingsList" class="list"></div>
</div>

<script src="js/storage.js"></script>
<script>
(function(){
  const list = document.getElementById("meetingsList");
  const qEl = document.getElementById("q");
  const countEl = document.getElementById("count");

  function normalize(s){
    return String(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();
  }
  function valOrDash(x){ const s = String(x||"").trim(); return s ? s : "—"; }

  // loadMeetings() vient de storage.js (ajouté précédemment)
  const meetings = (typeof loadMeetings === "function") ? loadMeetings() : [];

  function render(items){
    countEl.textContent = String(items.length);

    if (!items.length) {
      list.innerHTML = `<div class="muted">Aucun événement enregistré.</div>`;
      return;
    }

    list.innerHTML = items.map(m => {
      const nRaces = (m.raceIds && m.raceIds.length) ? m.raceIds.length : 0;
      return `
        <a class="item" href="meeting.html?id=${encodeURIComponent(m.id)}">
          <div class="title">
            ${valOrDash(m.name)}
            <span class="badge">${nRaces} épreuve${nRaces>1?"s":""}</span>
          </div>
          <div class="muted" style="margin-top:6px;">
            ${valOrDash(m.date)} • ${valOrDash(m.location)}
          </div>
          ${m.comment ? `<div class="muted" style="margin-top:6px;">${m.comment}</div>` : ``}
        </a>
      `;
    }).join("");
  }

  function apply(){
    const q = normalize(qEl.value);
    let items = meetings.slice();

    if (q) {
      items = items.filter(m => {
        const hay = normalize([m.name, m.location, m.comment].join(" "));
        return hay.includes(q);
      });
    }

    // tri : plus récent d'abord si date au format YYYY-MM-DD
    items.sort((a,b) => String(b.date||"").localeCompare(String(a.date||"")));

    render(items);
  }

  qEl.addEventListener("input", apply);
  apply();
})();
</script>

</body>
</html>
