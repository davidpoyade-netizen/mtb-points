<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MTB Points — Méthodologie (Calcul)</title>
  <style>
    :root{
      --bg:#f4f4f4;--card:#ffffff;--text:#0f172a;--muted:#64748b;
      --border:#e5e7eb;--blue:#2563eb;
    }
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;}
    header{background:#0b1220;color:#fff;padding:16px 18px;}
    header h1{margin:0;font-size:18px;}
    nav{margin-top:10px;font-size:14px;opacity:.95}
    nav a{color:#cbd5e1;text-decoration:none;margin-right:12px}
    nav a:hover{color:#fff;text-decoration:underline}
    .wrap{max-width:980px;margin:18px auto;padding:0 14px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin:14px 0;box-shadow:0 1px 2px rgba(0,0,0,.04);}
    h2{margin:0 0 10px 0;font-size:18px}
    h3{margin:18px 0 8px 0;font-size:15px}
    p,li{line-height:1.55;color:var(--text)}
    .muted{color:var(--muted)}
    code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
    pre{background:#0b1220;color:#e5e7eb;padding:12px;border-radius:12px;overflow:auto;border:1px solid #111827}
    .toc a{color:var(--blue);text-decoration:none}
    .toc a:hover{text-decoration:underline}
    .tag{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--muted);margin-right:6px}
    .note{border-left:4px solid var(--blue);padding:10px 12px;background:#eff6ff;border-radius:10px}
  </style>
</head>
<body>
<header>
  <h1>MTB Points — Méthodologie (Calcul)</h1>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="classement.html">Classement</a>
    <a href="evenements.html">Événements</a>
    <a href="reglement.html">Règlement</a>
    <a href="methodologie.html"><strong>Méthodologie</strong></a>
    <a href="apropos.html">À propos</a>
    <a href="login.html">Connexion</a>
  </nav>
</header>

<div class="wrap">

  <div class="card">
    <div class="tag">MVP</div>
    <div class="tag">GPX</div>
    <div class="tag">OSM</div>
    <p class="muted">Pour les règles d’éligibilité, statuts, import, litiges : voir <a href="reglement.html">Règlement</a>.</p>

    <h2>Sommaire</h2>
    <ul class="toc">
      <li><a href="#mrs">1. Score Épreuve (MRS)</a></li>
      <li><a href="#phys">2. Score physique (ScorePhys)</a></li>
      <li><a href="#tech">3. Score technique (ScoreTech — OSM + pente)</a></li>
      <li><a href="#calib">4. Paramètres & calibration</a></li>
    </ul>
  </div>

  <div class="card" id="mrs">
    <h2>1. Score Épreuve (MRS)</h2>
    <p>Le score global de difficulté d’une épreuve (MRS) combine le score physique et le score technique.</p>
    <pre><code>MRS = round(0.55 × ScorePhys + 0.45 × ScoreTech)</code></pre>
    <p class="muted">MRS est borné sur 0–100.</p>
  </div>

  <div class="card" id="phys">
    <h2>2. Score physique (ScorePhys)</h2>

    <h3>2.1 Objectif</h3>
    <p>Le score physique modélise l’effort physiologique global imposé par l’épreuve à partir du GPX. Il doit refléter la distance, le dénivelé, et la sévérité du relief (pentes répétées/raides), tout en restant stable et comparable entre épreuves.</p>

    <h3>2.2 Données d’entrée (GPX)</h3>
    <ul>
      <li><strong>D</strong> : distance totale (km)</li>
      <li><strong>H⁺</strong> : dénivelé positif total (m)</li>
      <li><strong>IPB</strong> : indice de pénibilité (distribution des pentes : segments raides + fréquence)</li>
    </ul>

    <h3>2.3 Calcul</h3>
    <p><strong>Étape 1 — Effort de base</strong></p>
    <pre><code>EffortBase = sqrt(D) + (H⁺ / 1000)</code></pre>
    <p class="muted">√D limite l’effet “longueur pure”, H⁺/1000 valorise le relief.</p>

    <p><strong>Étape 2 — Normalisation</strong></p>
    <pre><code>EffortNorm = clamp(EffortBase / 10, 0, 1)
IPB_norm   = clamp(IPB / 120, 0, 1)</code></pre>
    <p class="muted">10 et 120 sont des références calibrables (MVP).</p>

    <p><strong>Étape 3 — Combinaison</strong></p>
    <pre><code>ScorePhys = round(100 × clamp(0.70×EffortNorm + 0.30×IPB_norm, 0, 1))</code></pre>
    <p class="muted">70% effort global, 30% sévérité (IPB).</p>

    <h3>2.4 Interprétation (indicative)</h3>
    <ul>
      <li>0 – 25 : Faible</li>
      <li>25 – 45 : Modéré</li>
      <li>45 – 65 : Soutenu</li>
      <li>65 – 80 : Très exigeant</li>
      <li>80 – 100 : Extrême / ultra</li>
    </ul>
  </div>

  <div class="card" id="tech">
    <h2>3. Score technique (ScoreTech — OSM + pente)</h2>

    <div class="note">
      <strong>Principe clé :</strong> un GPX seul ne décrit pas la “nature du terrain” (rocaille, racines, surface).  
      MTB Points calcule donc ScoreTech en combinant <strong>(1) OSM</strong> (tags surface/chemin/mtb:scale…) + <strong>(2) la pente locale</strong> (issue du GPX) + <strong>(3) la sinuosité</strong>.
    </div>

    <h3>3.1 Données d’entrée</h3>
    <ul>
      <li><strong>GPX</strong> : points (lat/lon/ele) → segmentation, sinuosité, pentes</li>
      <li><strong>OSM</strong> : tags le long du tracé (échantillonnage ~200 m) : <code>highway</code>, <code>surface</code>, <code>smoothness</code>, <code>tracktype</code>, <code>mtb:scale</code>, <code>sac_scale</code></li>
    </ul>

    <h3>3.2 Segmentation</h3>
    <p>La trace est découpée en segments par distance (fenêtres typiques 300 m, bornées 200–500 m).</p>

    <h3>3.3 Indicateurs par segment</h3>

    <p><strong>A) Sinuosité</strong></p>
    <pre><code>Sinuosity = dist_reelle / dist_vol_oiseau
SinuNorm  = clamp((Sinuosity - 1.0) / 0.30, 0, 1)</code></pre>

    <p><strong>B) Pente “technique” (GPX)</strong></p>
    <pre><code>grade   = Δele / Δdist   (ex: 0.15 = 15%)
p_steep = proportion(|grade| ≥ 0.12)
p_very  = proportion(|grade| ≥ 0.18)
g_max   = percentile90(|grade|)

SlopeTech =
  clamp(
    0.60*p_steep
  + 0.40*p_very
  + 0.50*clamp((g_max - 0.10)/0.20, 0, 1),
  0, 1
)</code></pre>

    <p><strong>C) TerrainScore (OSM) — 0 à 1</strong></p>
    <p class="muted">Priorité : mtb:scale → smoothness → highway/surface/tracktype. Fallback si OSM indisponible.</p>
    <pre><code>TerrainScore (priorités)
1) si mtb:scale présent : score = clamp(mtb_scale/5, 0, 1)
2) sinon smoothness :
   excellent/good -> 0.2–0.3
   intermediate   -> 0.5
   bad            -> 0.7
   very_bad..     -> 0.85–1.0
3) sinon highway/surface/tracktype :
   asphalt/cycleway/road -> 0.0
   track + grade1        -> 0.2
   track + grade2        -> 0.35
   track + grade3        -> 0.5
   path                  -> 0.6
   surface rock/stone... -> +0.2 (cap 1.0)
Fallback si OSM vide : TerrainScore = 0.40</code></pre>

    <h3>3.4 Coefficient technique segment</h3>
    <pre><code>TechCoeff_seg =
  clamp(
    0.80
  + 0.18*TerrainScore
  + 0.14*SinuNorm
  + 0.18*SlopeTech,
    0.80, 1.80
  )</code></pre>

    <h3>3.5 Agrégation (percentile 75 pondéré)</h3>
    <p>On agrège via un percentile 75 pondéré par la longueur des segments, afin de refléter les secteurs “déterminants”.</p>
    <pre><code>TechCoeff_P75 = weightedPercentile(TechCoeff_seg, weights=seg_length, p=0.75)</code></pre>

    <h3>3.6 Score technique final (0–100)</h3>
    <pre><code>ScoreTech = round(100 × clamp((TechCoeff_P75 − 0.80) / 1.00, 0, 1))</code></pre>

    <p class="muted">Interprétation rapide : 0–30 roulants / 30–60 mixte / 60–85 technique / 85–100 très technique (alpin/rocailleux).</p>
  </div>

  <div class="card" id="calib">
    <h2>4. Paramètres & calibration</h2>
    <ul>
      <
